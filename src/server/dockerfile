FROM golang:1.24.4-alpine

# Install required packages
RUN apk add --no-cache iptables iproute2 gcc musl-dev linux-headers git make

WORKDIR /app

# Copy go mod files
COPY go.mod go.sum ./
RUN go mod download

# Copy source code
COPY . .

# Build the server with verbose output
RUN go build -v -o vpn-server ./src/Server.go && \
    chmod +x vpn-server 
# Expose VPN port
EXPOSE 8080/udp

# Use absolute path and add error checking
CMD ["/app/vpn-server"]